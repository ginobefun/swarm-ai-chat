# SwarmAI.chat 测试执行记录

**日期**: 2025-11-05  
**测试人**: Gino Zhang  
**环境**: 本地开发环境  

---

## ✅ 环境检查

| 项目 | 状态 | 版本/备注 |
|------|------|----------|
| Node.js | ✅ | v22.19.0 |
| pnpm | ✅ | 10.17.1 |
| PostgreSQL | ✅ | 16-alpine (Docker容器运行中) |
| DATABASE_URL | ✅ | 已配置 |
| OPENROUTER_API_KEY | ⚠️ | 需要手动配置真实密钥 |
| BETTER_AUTH_SECRET | ✅ | 已生成 |
| Prisma Client | ✅ | v6.18.0 已生成 |
| 数据库模式 | ✅ | 已推送并填充种子数据 |

---

## 🧪 自动化测试结果

**执行时间**: 2025-11-05 20:00:28  
**测试框架**: Vitest v4.0.7  

### 测试概览
- ✅ **测试文件**: 12 passed
- ✅ **测试用例**: 189 passed | 2 skipped
- ⏱️ **执行时间**: 3.32s

### 测试模块详情

| 模块 | 测试数 | 状态 | 耗时 |
|------|--------|------|------|
| Artifact Parser | 21 | ✅ | 5ms |
| Agent Metrics | 11 | ✅ | 6ms |
| Chart Types | 24 | ✅ | 4ms |
| Artifact Version Control | 12 | ✅ | 5ms |
| Type Definitions | 13 | ✅ | 5ms |
| Supervisor Agent | 11 (2 skipped) | ✅ | 6ms |
| Orchestrator | 17 | ✅ | 9ms |
| SafeMarkdown Component | 24 | ✅ | 129ms |
| React Memo Optimization | 15 | ✅ | 143ms |
| Context Manager | 13 | ✅ | 1387ms |
| Token Estimation | 15 | ✅ | 1982ms |
| API Client Rate Limit | 13 | ✅ | 2659ms |

### 性能测试结果
- ✅ 速率限制测试通过 (1056ms)
- ✅ 请求队列测试通过 (303ms)
- ✅ 重试机制测试通过 (1001ms)

---

## 📋 手动测试清单

### 1. 用户认证与授权 (高优先级)

#### 1.1 用户注册
- [ ] 使用有效的电子邮件和密码注册新用户
- [ ] 验证密码强度要求
- [ ] 测试重复邮箱注册（应该失败）
- [ ] 验证用户名唯一性
- [ ] 检查注册成功后自动登录

#### 1.2 用户登录
- [ ] 使用正确的凭证登录
- [ ] 使用错误的密码（应该失败）
- [ ] 使用不存在的邮箱（应该失败）
- [ ] 验证 "记住我" 功能
- [ ] 测试登录后的会话持久性

#### 1.3 用户登出
- [ ] 点击登出按钮
- [ ] 验证 session 被清除
- [ ] 确认重定向到登录页面

---

### 2. 会话管理 (高优先级)

#### 2.1 创建会话
- [ ] 点击 "新对话" 按钮
- [ ] 输入会话标题和描述
- [ ] 选择主要 Agent
- [ ] 选择会话类型（单人/群聊）
- [ ] 验证会话在侧边栏显示

**测试数据**:
```json
{
  "title": "测试会话",
  "description": "这是一个测试会话",
  "type": "SINGLE",
  "primaryAgentId": "gemini-flash"
}
```

#### 2.2 切换会话
- [ ] 从侧边栏选择不同的会话
- [ ] 验证消息历史正确加载
- [ ] 确认上下文切换正确

#### 2.3 编辑会话
- [ ] 点击会话的编辑按钮
- [ ] 修改标题和描述
- [ ] 保存更改
- [ ] 验证更改立即反映在 UI 中

#### 2.4 删除会话
- [ ] 点击删除按钮
- [ ] 确认删除对话框
- [ ] 验证会话从列表中移除
- [ ] 确认相关数据被删除

#### 2.5 固定会话
- [ ] 点击固定图标
- [ ] 验证固定的会话置顶显示
- [ ] 取消固定后恢复原位置

---

### 3. 消息功能 (关键功能)

#### 3.1 发送消息
- [ ] 在输入框输入消息
- [ ] 点击发送或按 Enter 键
- [ ] 验证消息立即显示
- [ ] 确认 AI 响应流式显示

**测试消息**:
1. "你好，请介绍一下自己"
2. "帮我生成一个 Python 函数来计算斐波那契数列"
3. "创建一个 React 组件显示用户列表"
4. "用 Mermaid 图表展示软件架构"

#### 3.2 消息格式化
- [ ] 发送包含 Markdown 的消息
- [ ] 验证粗体、斜体、列表渲染
- [ ] 测试代码块语法高亮
- [ ] 检查链接是否可点击

**测试消息**:
```markdown
# 标题测试
## 二级标题

**粗体文本** 和 *斜体文本*

- 列表项 1
- 列表项 2

[链接测试](https://example.com)

代码测试：`const x = 10;`
```

#### 3.3 @ 提及功能
- [ ] 输入 @ 符号
- [ ] 验证 Agent 列表弹出
- [ ] 选择一个 Agent
- [ ] 发送消息并验证 Agent 参与

---

### 4. Artifact 功能 (核心功能)

#### 4.1 代码 Artifact
- [ ] 请求 AI 生成代码
- [ ] 验证 Artifact 面板显示
- [ ] 检查语法高亮
- [ ] 测试复制代码按钮
- [ ] 验证多语言支持

**测试提示**:
- "生成一个 Python 函数来排序数组"
- "创建一个 React 组件显示表格"
- "写一个 SQL 查询来统计用户数量"

#### 4.2 Mermaid 图表 Artifact
- [ ] 请求 AI 生成流程图
- [ ] 验证 Mermaid 图表正确渲染
- [ ] 测试不同类型的图表

**测试提示**:
- "创建一个用户注册流程的流程图"
- "绘制一个微服务架构的组件图"

#### 4.3 Chart Artifact
- [ ] 请求 AI 生成数据可视化
- [ ] 验证图表正确渲染
- [ ] 测试不同图表类型

---

### 5. 错误处理 (关键)

#### 5.1 网络错误
- [ ] 断开网络连接
- [ ] 发送消息
- [ ] 验证错误提示
- [ ] 恢复网络后重试

#### 5.2 API 错误
- [ ] 模拟 API 超时
- [ ] 模拟 API 500 错误
- [ ] 模拟速率限制

---

### 6. UI/UX 测试

#### 6.1 响应式设计
- [ ] 在移动设备上测试（< 768px）
- [ ] 在平板设备上测试（768px - 1024px）
- [ ] 在桌面上测试（> 1024px）

#### 6.2 深色模式
- [ ] 切换到深色模式
- [ ] 验证所有组件颜色适配
- [ ] 检查对比度和可读性
- [ ] 测试深浅模式切换流畅性

---

## 🐛 发现的问题

_待测试过程中填写_

### 问题模板
```markdown
**[BUG-XXX] 问题标题**
- 严重程度：[高/中/低]
- 复现步骤：
  1. ...
  2. ...
- 预期结果：...
- 实际结果：...
- 截图/日志：...
```

---

## 📊 性能指标

_待测试完成后填写_

- 首屏加载时间：
- 消息发送响应时间：
- 100条消息滚动帧率：
- 内存使用：

---

## ⚠️ 注意事项

1. **OpenRouter API 密钥**: 需要获取真实的 API 密钥才能测试聊天功能
   - 访问: https://openrouter.ai/
   - 配置到 `.env.local` 中的 `OPENROUTER_API_KEY`

2. **数据库**: PostgreSQL 容器必须运行
   - 检查: `docker ps | grep swarm-postgres`
   - 启动: `docker start swarm-postgres`

3. **环境变量**: 启动服务器前加载环境变量
   - 使用快捷脚本: `./dev.sh`
   - 或手动: `export $(cat .env.local | grep -v '^#' | xargs) && pnpm dev`

---

## ✅ 下一步

1. **获取 OpenRouter API 密钥** - 必需，用于聊天功能
2. **启动开发服务器** - `./dev.sh` 或 `pnpm dev`
3. **开始手动测试** - 按照上述清单逐项测试
4. **记录发现的问题** - 在本文档中记录所有 bug
5. **更新测试状态** - 完成测试后更新复选框

---

## 📝 总体评估

_测试完成后填写_

- [ ] ✅ **可以发布**: 所有关键功能正常，无阻塞性bug
- [ ] ⚠️ **需要修复**: 存在影响用户体验的问题
- [ ] ❌ **不可发布**: 存在严重bug或功能缺失

---

**测试状态**: 🚧 准备中  
**最后更新**: 2025-11-05
